<h1>{{ pageContent.heading }}</h1>
<div class="mb-6 mb-md-7" [innerHtml]="pageContent.summary"></div>

<div *ngIf="showOverallError">
  <span>{{ overallErrorContent.heading }}</span>
  <span>{{ overallErrorContent.summary }}</span>
</div>
<form
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
  class=""
  novalidate
  wesInvalidControlScroll
>
  <div class="form-group">
    <label for="honorific-prefix" data-test="lblTitle">{{
      pageContent.title.inputLabel
    }}</label>
    <select
      formControlName="title"
      name="honorific-prefix"
      class="form-control"
      data-test="ddTitle"
    >
      <option
        *ngFor="let title of titleList$ | async"
        value="{{ title.value }}"
        >{{ title.description }}</option
      >
    </select>

    <ng-container *ngIf="isFieldInvalid('title')">
      <span *ngIf="controls.title.errors.required">
        {{ pageContent.title.inputError }}
      </span>
    </ng-container>
  </div>

  <!-- <mat-form-field
    appearance="fill"
    class="mat-form-field mat-primary mat-form-field-type-mat-input mat-form-field-appearance-fill mat-form-field-can-float mat-form-field-has-label mat-form-field-hide-placeholder"
    ><div class="mat-form-field-wrapper">
      <div class="mat-form-field-flex">
        <div class="mat-form-field-prefix">
          <span matprefix="" class="">$&nbsp;</span>
        </div>

        <div class="mat-form-field-infix">
          <input
            matinput=""
            type="number"
            class="mat-input-element mat-form-field-autofill-control example-right-align cdk-text-field-autofill-monitored"
            id="mat-input-11"
            aria-invalid="false"
            aria-required="false"
          />
          <span class="mat-form-field-label-wrapper">
            <label
              class="mat-form-field-label mat-empty mat-form-field-empty"
              id="mat-form-field-label-29"
              for="mat-input-11"
              aria-owns="mat-input-11"
            >
              <mat-label class="">Amount</mat-label>
            </label></span
          >
        </div>
        <div class="mat-form-field-suffix">
          <span matsuffix="" class="">.00</span>
        </div>
      </div>

      <div class="mat-form-field-subscript-wrapper">
        <div class="mat-form-field-hint-wrapper">
          <div class="mat-form-field-hint-spacer"></div>
        </div>
      </div></div
  ></mat-form-field> -->

  <div class="form-group">
    <label for="firstName" data-test="lblFirstName">{{
      pageContent.firstName.inputLabel
    }}</label>
    <input
      class="form-control"
      type="text"
      name="firstName"
      formControlName="firstName"
      autocomplete="given-name"
      data-test="txtFirstName"
    />
    <ng-container *ngIf="isFieldInvalid('firstName')">
      <span *ngIf="controls.firstName.errors.required">
        {{ pageContent.firstName.inputError }}
      </span>
    </ng-container>
  </div>

  <div class="form-group">
    <label for="lastName" data-test="lblLastName">{{
      pageContent.surname.inputLabel
    }}</label>
    <input
      class="form-control"
      type="text"
      name="lastName"
      formControlName="lastName"
      autocomplete="family-name"
      data-test="lblLastName"
    />
    <ng-container *ngIf="isFieldInvalid('lastName')">
      <span *ngIf="controls.lastName.errors.required">
        {{ pageContent.surname.inputError }}
      </span>
    </ng-container>
  </div>

  <div class="form-group" formGroupName="dob">
    <label data-test="lblDoB">{{ pageContent.dob.inputLabel }}</label>
    <div class="row">
      <input
        class="form-control col-sm-2"
        formControlName="day"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        name="bday-day"
        placeholder="DD"
        wesNumbersOnly
        maxlength="2"
        autocomplete="bday-day"
        data-test="txtDoBDay"
      />

      <input
        class="form-control col-sm-2"
        formControlName="month"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        maxlength="2"
        name="bday-month"
        placeholder="MM"
        wesNumbersOnly
        autocomplete="bday-month"
        data-test="txtDoBMonth"
      />

      <input
        class="form-control col-sm-2"
        formControlName="year"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        maxlength="4"
        name="bday-year"
        placeholder="YYYY"
        wesNumbersOnly
        autocomplete="bday-year"
        data-test="txtDoBYear"
      />
    </div>

    <ng-container *ngIf="isFieldInvalid('dob')">
      <span *ngIf="controls.dob.errors.invalidDate">
        {{ pageContent.dob.inputError }}
      </span>
      <span *ngIf="controls.dob.errors.tooYoungOrTooOld">
        {{ pageContent.dob.inputOtherError }}
      </span>
    </ng-container>
  </div>

  <div class="form-group">
    <label for="profession" data-test="txtProfession">{{
      pageContent.profession.inputLabel
    }}</label>
    <select
      class="form-control"
      formControlName="profession"
      name="profession"
      data-test="ddProfession"
    >
      <option
        *ngFor="let marketSegment of marketSegmentList$ | async"
        value="{{ marketSegment.value }}"
        >{{ marketSegment.description }}</option
      >
    </select>
    <ng-container *ngIf="isFieldInvalid('profession')">
      <span *ngIf="controls.profession.errors.required">
        {{ pageContent.profession.inputError }}
      </span>
    </ng-container>
  </div>

  <div class="form-group">
    <label for="nationalInsuranceNumber" data-test="lblNino">{{
      pageContent.niNumber.inputLabel
    }}</label>
    <input
      class="form-control"
      type="text"
      name="nationalInsuranceNumber"
      formControlName="nationalInsuranceNumber"
      data-test="txtNino"
    />
    <span>{{ pageContent.niTooltip }}</span>
    <ng-container *ngIf="isFieldInvalid('nationalInsuranceNumber')">
      <span *ngIf="controls.nationalInsuranceNumber.invalid">
        {{ pageContent.niNumber.inputError }}
      </span>
    </ng-container>
  </div>

  <div class="form-group">
    <label for="nationality" data-test="lblNationality">{{
      pageContent.nationality.inputLabel
    }}</label>
    <select
      class="form-control"
      formControlName="nationality"
      name="nationality"
      data-test="ddNationality"
    >
      <option
        *ngFor="let nationality of nationalityList$ | async"
        value="{{ nationality.value }}"
        >{{ nationality.description }}</option
      >
    </select>

    <ng-container *ngIf="isFieldInvalid('nationality')">
      <span *ngIf="controls.nationality.errors.required">
        {{ pageContent.nationality.inputError }}
      </span>
    </ng-container>
  </div>

  <h3>{{ pageContent.addressDetails.heading }}</h3>
  <span [innerHTML]="pageContent.addressDetails.summary"></span>
  <wes-address-lookup-form
    *ngIf="!isManualAddressVisible"
    formControlName="addressLookup"
    [touched]="controls.addressLookup.touched"
    [submitAttempt$]="submitAttempt$"
    (searchedAddress)="onFindPostcode($event)"
    (selectedAddress)="onSelectedAddress($event)"
    (showManualAddress)="onShowManualAddress($event)"
  ></wes-address-lookup-form>

  <button
    *ngIf="isManualAddressVisible"
    type="button"
    class="wes-button wes-button-link"
    (click)="onShowAddressLookup()"
    data-test="btnShowFindAddress"
  >
    {{ pageContent.addressDetails.findAddress }}
  </button>
  <wes-manual-address-form
    [style.display]="isManualAddressVisible ? 'block' : 'none'"
    formControlName="manualAddress"
    [touched]="controls.manualAddress.touched"
    [submitAttempt]="submitAttempt$ | async"
  ></wes-manual-address-form>

  <h3>{{ pageContent.contactDetails.heading }}</h3>
  <div class="form-group">
    <label for="personalEmail" data-test="lblPersonalEmail">{{
      pageContent.contactDetails.personalEmail.inputLabel
    }}</label>
    <input
      class="form-control"
      type="email"
      name="personalEmail"
      formControlName="personalEmail"
      autocomplete="email"
      data-test="txtPersonalEmail"
    />

    <span
      *ngIf="
        controls.personalEmail.invalid &&
        (showOverallError ||
          controls.personalEmail.dirty ||
          controls.personalEmail.touched)
      "
    >
      {{ pageContent.contactDetails.personalEmail.inputError }}
    </span>
  </div>

  <div class="form-group">
    <label for="personalMobileNumber" data-test="lblPersonalMobileNumber">{{
      pageContent.contactDetails.mobileNumber.inputLabel
    }}</label>
    <input
      class="form-control"
      type="text"
      name="personalMobileNumber"
      formControlName="personalMobileNumber"
      autocomplete="tel"
      data-test="textPersonalMobileNumber"
    />
    <span
      *ngIf="
        controls.personalMobileNumber.invalid &&
        (showOverallError ||
          controls.personalMobileNumber.dirty ||
          controls.personalMobileNumber.touched)
      "
    >
      {{ pageContent.contactDetails.mobileNumber.inputError }}
    </span>
  </div>

  <div class="mb-4" [innerHTML]="pageContent.marketing.heading"></div>

  <div class="mb-3">
    <wes-checkbox
      formControlName="marketingEmail"
      class="d-block mb-2"
      labelTestId="lblMarketingEmail"
      inputTestId="cbMarketingEmail"
      >{{ pageContent.marketing.email }}</wes-checkbox
    >
    <wes-checkbox
      formControlName="marketingPhone"
      class="d-block mb-2"
      labelTestId="lblMarketingPhone"
      inputTestId="cbMarketingPhone"
      >{{ pageContent.marketing.phone }}</wes-checkbox
    >
    <wes-checkbox
      formControlName="marketingPost"
      class="d-block"
      labelTestId="lblMarketingPost"
      inputTestId="cbMarketingPost"
      >{{ pageContent.marketing.post }}</wes-checkbox
    >
  </div>
  <div [innerHTML]="pageContent.privacy"></div>

  <button
    class="wes-button wes-button-primary d-block w-100 w-md-auto mt-5 mt-md-6"
    type="submit"
    data-test="btnContinue"
  >
    Continue
  </button>
</form>

<!-- <pre>
    Valid FULL FORM: {{ form.valid | json }}
    Valid Lookup {{ form.controls.addressLookup.valid }}
    Valid Manual {{ form.controls.manualAddress.valid }}
    Show BigO {{ showOverallError }}
    {{ form.value | json }}
</pre> -->
